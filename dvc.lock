schema: '2.0'
stages:
  split-data:
    cmd: python src/split_data.py
    deps:
    - path: data/raw/train.csv
      md5: 8cf8d6d39aecf7cc6466eb79b0ed6e1b
      size: 805421
    - path: src/split_data.py
      md5: b17eada5aa5f42dee72f375d672dc76e
      size: 1089
    params:
      params.yaml:
        split-data:
          random_state: 13
          val_size: 0.25
    outs:
    - path: data/datasets/train.csv
      md5: 384dce5c4b08532745e343cca6c5c851
      size: 605020
    - path: data/datasets/val.csv
      md5: 22326675599eb80cd0f6c3f58194d946
      size: 200523
  compute-train-features:
    cmd: python src/compute_features.py --input-file data/datasets/train.csv --output-file
      data/features/train.csv
    deps:
    - path: data/datasets/train.csv
      md5: 384dce5c4b08532745e343cca6c5c851
      size: 605020
    - path: src/compute_features.py
      md5: 0f820f2fedeae1cfb4957811f99e0842
      size: 1375
    outs:
    - path: data/features/train.csv
      md5: 30e453fb76fea5564559c0e90373be32
      size: 820723
  train:
    cmd: python src/train_model.py --training-data data/features/train.csv --model-path
      models/hgb_classifier
    deps:
    - path: data/features/train.csv
      md5: 30e453fb76fea5564559c0e90373be32
      size: 820723
    - path: src/train_model.py
      md5: 41dddfce645ea2ca0735c6e3c4bd47bc
      size: 2909
    params:
      params.yaml:
        train:
          random_state: 13
          l2_regularization: 0.1
          learning_rate: 0.01
          max_iter: 1000
          max_depth: 5
    outs:
    - path: models/hgb_classifier
      md5: 3c63fa00b60a8dfc8d8ca3622410ec17
      size: 2312572
    - path: models/hgb_classifier.mlem
      md5: 3229a7441d79582b808d2f12d048057e
      size: 2279
    - path: models/hgb_classifier_lambda
      md5: 24b0cae74951ef3899d6bcdf6f51af90
      size: 2328281
    - path: models/hgb_classifier_lambda.mlem
      md5: e8a43adfa02bbb3aaad4a164a5380fb2
      size: 2966
  compute-val-features:
    cmd: python src/compute_features.py --input-file data/datasets/val.csv --output-file
      data/features/val.csv
    deps:
    - path: data/datasets/val.csv
      md5: 22326675599eb80cd0f6c3f58194d946
      size: 200523
    - path: src/compute_features.py
      md5: 0f820f2fedeae1cfb4957811f99e0842
      size: 1375
    outs:
    - path: data/features/val.csv
      md5: 53478917ed989be00852627b269e5b38
      size: 272213
  evaluate:
    cmd: mkdir -p metrics; python src/evaluate_model.py --test-data data/features/val.csv
      --model-path models/hgb_classifier > metrics/test.json
    deps:
    - path: data/features/val.csv
      md5: 53478917ed989be00852627b269e5b38
      size: 272213
    - path: models/hgb_classifier
      md5: 3c63fa00b60a8dfc8d8ca3622410ec17
      size: 2312572
    - path: src/evaluate_model.py
      md5: dfbd87c5c100e7979c6060be9fb8997d
      size: 1215
    outs:
    - path: data/predictions/val.csv
      md5: 77f155aacfb8abeece7701aa8adc616d
      size: 50844
    - path: metrics/test.json
      md5: 465b96554c06a54e3c3aaf351405618d
      size: 170
  render-EDA:
    cmd: jupyter nbconvert --to html --execute notebooks/1.0-eda.ipynb --output-dir
      reports/
    deps:
    - path: data/raw/train.csv
      md5: 8cf8d6d39aecf7cc6466eb79b0ed6e1b
      size: 805421
    - path: notebooks/1.0-eda.ipynb
      md5: 49395fb93c957c4987a2176080f5669c
      size: 3493
    outs:
    - path: reports/1.0-eda.html
      md5: ea79c7cd80bb8b9bd8d11b1b81a048d4
      size: 883752
  compute-test-features:
    cmd: python src/compute_features.py --input-file data/raw/test.csv --output-file
      data/features/test.csv
    deps:
    - path: data/raw/test.csv
      md5: 5ded803886f27a2f241763327b14a19e
      size: 372487
    - path: src/compute_features.py
      md5: 0f820f2fedeae1cfb4957811f99e0842
      size: 1375
    outs:
    - path: data/features/test.csv
      md5: fdebcb1516ed0a5a4a281dd03edf010c
      size: 513853
  create_submission:
    cmd: mlem apply models/hgb_classifier_lambda data/features/test.csv --method __call__
      --import --it "pandas[csv]" --output data/predictions/submission.csv
    deps:
    - path: data/features/test.csv
      md5: 8c46ac0db01d09b1be0ece394e3127f5
      size: 490518
    - path: models/hgb_classifier_lambda
      md5: 6c20682c2607d683c509ff63e5b97be3
      size: 371219
    outs:
    - path: data/predictions/submission.csv
      md5: 948e6e08cafddae7265534253a36e4aa
      size: 57747
    - path: data/predictions/submission.csv.mlem
      md5: be14d91cbe4023d08377efa9ae255ae7
      size: 356
  fetch-data:
    cmd: kaggle competitions download -c spaceship-titanic; unzip spaceship-titanic.zip;
      rm spaceship-titanic.zip sample_submission.csv;
    outs:
    - path: test.csv
      md5: 5ded803886f27a2f241763327b14a19e
      size: 372487
    - path: train.csv
      md5: 8cf8d6d39aecf7cc6466eb79b0ed6e1b
      size: 805421
  create-submission:
    cmd: mlem apply models/hgb_classifier_lambda data/features/test.csv --method __call__
      --import --it "pandas[csv]" --output data/predictions/submission.csv
    deps:
    - path: data/features/test.csv
      md5: fdebcb1516ed0a5a4a281dd03edf010c
      size: 513853
    - path: models/hgb_classifier_lambda
      md5: 24b0cae74951ef3899d6bcdf6f51af90
      size: 2328281
    outs:
    - path: data/predictions/submission.csv
      md5: 7910d9467b12837b0bb418e1dd4ac3f3
      size: 57699
    - path: data/predictions/submission.csv.mlem
      md5: c0aa16ca888c49cc37274a3ca7051bf3
      size: 356
  submit-to-kaggle:
    cmd: kaggle competitions submit -c spaceship-titanic -f data/predictions/submission.csv
      -m "$(git rev-parse --short HEAD)"
    deps:
    - path: data/predictions/submission.csv
      md5: 948e6e08cafddae7265534253a36e4aa
      size: 57747
