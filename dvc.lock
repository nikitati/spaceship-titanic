schema: '2.0'
stages:
  split-data:
    cmd: python src/split_data.py
    deps:
    - path: data/raw/train.csv
      md5: 8cf8d6d39aecf7cc6466eb79b0ed6e1b
      size: 805421
    - path: src/split_data.py
      md5: 48c61bf4e927a6251c16289228560d54
      size: 938
    outs:
    - path: data/datasets/train.csv
      md5: 384dce5c4b08532745e343cca6c5c851
      size: 605020
    - path: data/datasets/val.csv
      md5: 22326675599eb80cd0f6c3f58194d946
      size: 200523
  compute-train-features:
    cmd: python src/compute_features.py --input-file data/datasets/train.csv --output-file
      data/features/train.csv
    deps:
    - path: data/datasets/train.csv
      md5: 384dce5c4b08532745e343cca6c5c851
      size: 605020
    - path: src/compute_features.py
      md5: a6478b2bbad368467d82374936a53f9f
      size: 1377
    outs:
    - path: data/features/train.csv
      md5: e7c76568d8d1592d8c25ea00bab06304
      size: 785154
  train:
    cmd: python src/train_model.py --training-data data/features/train.csv --model-path
      models/hgb_classifier
    deps:
    - path: data/features/train.csv
      md5: e7c76568d8d1592d8c25ea00bab06304
      size: 785154
    - path: src/train_model.py
      md5: 0f43b6a1e67f70230f6567671f9aff0d
      size: 2855
    outs:
    - path: models/hgb_classifier
      md5: f87798ec6edfb9dea47c285a2a7bc420
      size: 369024
    - path: models/hgb_classifier.mlem
      md5: 10a00bd9cc7fb98daa205200f240b876
      size: 2194
    - path: models/hgb_classifier_lambda
      md5: 6c20682c2607d683c509ff63e5b97be3
      size: 371219
    - path: models/hgb_classifier_lambda.mlem
      md5: 9e6ab617263127b00e22cc75331f4ce4
      size: 2883
  compute-val-features:
    cmd: python src/compute_features.py --input-file data/datasets/val.csv --output-file
      data/features/val.csv
    deps:
    - path: data/datasets/val.csv
      md5: 22326675599eb80cd0f6c3f58194d946
      size: 200523
    - path: src/compute_features.py
      md5: a6478b2bbad368467d82374936a53f9f
      size: 1377
    outs:
    - path: data/features/val.csv
      md5: cbc56e1bf89bcbd823ca368d5df20ca3
      size: 260403
  evaluate:
    cmd: mkdir -p metrics; python src/evaluate_model.py --test-data data/features/val.csv
      --model-path models/hgb_classifier > metrics/test.json
    deps:
    - path: data/features/val.csv
      md5: cbc56e1bf89bcbd823ca368d5df20ca3
      size: 260403
    - path: models/hgb_classifier
      md5: f87798ec6edfb9dea47c285a2a7bc420
      size: 369024
    - path: src/evaluate_model.py
      md5: dfbd87c5c100e7979c6060be9fb8997d
      size: 1215
    outs:
    - path: data/predictions/val.csv
      md5: 7527c98039b3dcdf1b90a1ddf646c70b
      size: 50848
    - path: metrics/test.json
      md5: d60084d563a9f4b23a8b1621c843be4a
      size: 171
  render-EDA:
    cmd: jupyter nbconvert --to html --execute notebooks/1.0-eda.ipynb --output-dir
      reports/
    deps:
    - path: data/raw/train.csv
      md5: 8cf8d6d39aecf7cc6466eb79b0ed6e1b
      size: 805421
    - path: notebooks/1.0-eda.ipynb
      md5: 49395fb93c957c4987a2176080f5669c
      size: 3493
    outs:
    - path: reports/1.0-eda.html
      md5: ea79c7cd80bb8b9bd8d11b1b81a048d4
      size: 883752
  compute-test-features:
    cmd: python src/compute_features.py --input-file data/raw/test.csv --output-file
      data/features/test.csv
    deps:
    - path: data/raw/test.csv
      md5: 5ded803886f27a2f241763327b14a19e
      size: 372487
    - path: src/compute_features.py
      md5: a6478b2bbad368467d82374936a53f9f
      size: 1377
    outs:
    - path: data/features/test.csv
      md5: 8c46ac0db01d09b1be0ece394e3127f5
      size: 490518
  create_submission:
    cmd: mlem apply models/hgb_classifier_lambda data/features/test.csv --method __call__
      --import --it "pandas[csv]" --output data/predictions/submission.csv
    deps:
    - path: data/features/test.csv
      md5: 8c46ac0db01d09b1be0ece394e3127f5
      size: 490518
    - path: models/hgb_classifier_lambda
      md5: 6c20682c2607d683c509ff63e5b97be3
      size: 371219
    outs:
    - path: data/predictions/submission.csv
      md5: 948e6e08cafddae7265534253a36e4aa
      size: 57747
    - path: data/predictions/submission.csv.mlem
      md5: be14d91cbe4023d08377efa9ae255ae7
      size: 356
  fetch-data:
    cmd: kaggle competitions download -c spaceship-titanic; unzip spaceship-titanic.zip;
      rm spaceship-titanic.zip sample_submission.csv;
    outs:
    - path: test.csv
      md5: 5ded803886f27a2f241763327b14a19e
      size: 372487
    - path: train.csv
      md5: 8cf8d6d39aecf7cc6466eb79b0ed6e1b
      size: 805421
  create-submission:
    cmd: mlem apply models/hgb_classifier_lambda data/features/test.csv --method __call__
      --import --it "pandas[csv]" --output data/predictions/submission.csv
    deps:
    - path: data/features/test.csv
      md5: 8c46ac0db01d09b1be0ece394e3127f5
      size: 490518
    - path: models/hgb_classifier_lambda
      md5: 6c20682c2607d683c509ff63e5b97be3
      size: 371219
    outs:
    - path: data/predictions/submission.csv
      md5: 948e6e08cafddae7265534253a36e4aa
      size: 57747
    - path: data/predictions/submission.csv.mlem
      md5: be14d91cbe4023d08377efa9ae255ae7
      size: 356
  submit-to-kaggle:
    cmd: kaggle competitions submit -c spaceship-titanic -f data/predictions/submission.csv
      -m "$(git rev-parse --short HEAD)"
    deps:
    - path: data/predictions/submission.csv
      md5: 948e6e08cafddae7265534253a36e4aa
      size: 57747
